<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title property="schema:name">antoine.studio - documentation</title>
<meta content="documentation" name="description"/>
<meta content="antoine.studio" property="schema:name"/>
<meta content="documentation" property="schema:description"/>
<link href="assets/main.min.css" rel="stylesheet"/>
</head>
<body>
<main class="main page page--article">
<header class="header">
<nav class="nav">
<ul class="nav__list">
<li class="nav__item">
<a class="nav__link" href="index.html">antoine.studio</a>
</li>
<li class="nav__item">
<a class="nav__link" href="content.html">content</a>
</li>
<li class="nav__item">
<a class="nav__link" href="flux.html">flux</a>
</li>
<li class="nav__item">
<a class="nav__link" href="about.html">about</a>
</li>
</ul>
</nav>
</header>
<!-- content -->
<article class="article" id="machine-design">
<h1 class="article__title">Machine design</h1>
<p class="article__tags">Tags:
        
        <a class="tag__link" href="tag-fab-academy-assignments.html">#fab-academy-assignments</a>
<a class="tag__link" href="tag-to-review.html">#to-review</a>
</p>
<section class="article__toc">
<h3 class="toc__title--sub"><a href="machine-design.html#machine-design-making-the-field">Making the field ↓</a></h3>
<h3 class="toc__title--sub"><a href="machine-design.html#machine-design-coding-electronics">Coding the electronics ↓</a></h3>
</section>
<section class="article__content ts" id="content">
<h1 id="introduction">Introduction</h1>
<p>For the Machine Design week at the Fab Academy, we were asked to make a machine of any type, but one that we could operate and automate. I teamed up with <a class="external" href="https://fabacademy.org/2020/labs/barcelona/students/benjamin-scott/" target="_blank">Benjamin Scott</a> and we decided to go for a machine that plays Pong again itself. We call it the <em>Pong Machine</em>.</p>
<p>First of all, we had to find out how to make the machine we had in mind, which was not easy when we launched this project in June 2020, towards the official end of the Academy. A few months later, as the Covid-19 crisis subsides, we have a better understanding of the tools we have in the lab, how the mechanics work, what we have to produce by ourselves and what we can take from others.</p>
<p>I'm very happy with the way our project went, even if we didn't reach the final stage we were aiming for: Our machine doesn't play pong. But it can move its pallet according to the position of the ball, which is already something great for us. More time and testing could help us to develop the final version of our machine, perhaps in the near future? Let's see how it goes.</p>
<video controls="" preload="auto"><source src="medias/machine-design-metal-ball-compressed.mp4" type="video/mp4"/></video>
<video controls="" preload="auto"><source src="medias/machine-design-working-prototype-compressed.mp4" type="video/mp4"/></video>
<p>You can find our full documentation on our specific <em>Pong Machine</em> website.</p>
<p><a class="btn external" href="http://academany.fabcloud.io/fabacademy/2020/labs/barcelona/barcelona-machines/pong-machine/" target="_blank">Full documentation</a></p>
<h1 id="task-management">Task management</h1>
<p>With Benjamin, we did almost the whole project together because it was easier for us to learn the different steps together and help each other in real time. It's certainly not the best way to go fast, but it's certainly the best way to learn and act as a team. Nevertheless, we naturally divided the tasks according to our personal taste.</p>
<h2 id="benjamin">Benjamin</h2>
<p>Benjamin did the ball detection part. He prepared the field and made sure that our line detection logic worked properly, from the choice of equipment to the electronics to make it work. He also built the rails and made the connectors to make them stand upright.</p>
<h2 id="antoine">Antoine</h2>
<p>I designed and fabricated the mounting plate on which we attached the stepper motor and solenoid (which would be used to push the ball forward) and a 3D printed support for the solenoid.I also did the coding part of the project, so that we could move the motor according to what the lines say. I really enjoy solving logic problems.</p>
</section>
<footer>
<p>✎ <span>Created</span> 01/06/2020</p>
<p>⁂ <span>Updated</span> 10/11/2020</p>
</footer>
<article class="article--sub" id="machine-design-making-the-field">
<h1 class="article__title">Making the field <a href="machine-design-making-the-field.html">●</a></h1>
<section class="article__content ts">
<h1 id="mounting-plate">Mounting plate</h1>
<p>I designed and laser-cut a mounting plate made of acrylic (<code>10 mm</code>) with the imprints of our elements (NEMA17 stepper motor and solenoid) in order to be able to fix our elements to the structure, and thus make it move when the stepper motor is actuated.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-mounting-plate-freecad.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-mounting-plate-measures.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-field-02.jpg"><figcaption></figcaption></figure>
<figure class="lg"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-mounting-plate-2.jpg"><figcaption></figcaption></figure>
<h1 id="solenoid-holder">Solenoid holder</h1>
<p>To fix the solenoid, which will then be used to push the ball forward, I designed an holder that we could screw onto our mounting plate.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-solenoid-holder.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-solenoid-holder-01.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-solenoid-holder-02.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-making-the-field-solenoid-holder-03.jpg"><figcaption></figcaption></figure>
<h1 id="files">Files</h1>
<ul>
<li>Solenoid holder (Freecad design file): <a class="internal" href="file:system-solenoid.FCStd">system-solenoid.FCStd</a></li>
<li>Solenoid holder (Fabrication file): <a class="internal" href="file:solenoid-holder-2.stl">solenoid-holder-2.stl</a></li>
<li>Mounting plate (Freecad design file): <a class="internal" href="file:mounting-plate.FCStd">mounting-plate.FCStd</a></li>
<li>
<ul>
<li>Mounting plate (Fabrication file): <a class="internal" href="file:mounting-plate.dxf">mounting-plate.dxf</a></li>
</ul>
</li>
</ul>
</section>
<aside>
<p>✎ <span>Created</span> 09/11/2020</p>
<p>⁂ <span>Updated</span> 09/11/2020</p>
</aside>
</article>
<article class="article--sub" id="machine-design-coding-electronics">
<h1 class="article__title">Coding the electronics <a href="machine-design-coding-electronics.html">●</a></h1>
<section class="article__content ts">
<p>The following code does two main things for our Pong Machine. The first is the calibration of the stepper motor, in order to know how many steps separate the beginning from the end of the rail, and therefore to know how to move the paddle. The second is to update the position of the motor according to any crossed lines in the field, in order to follow the ball. Later, it will actuate the solenoid to push the ball forward.</p>
<h1 id="calibration">Calibration</h1>
<p>To calibrate, I run the stepper motor in one direction until it reaches an endstop, then I make it move in the other direction counting all the steps the motor takes until we reach the other endstop. Once we know how many steps separate the beginning from the end, we can place the motor in the middle and start the game.</p>
<video controls="" preload="auto"><source src="medias/machine-design-coding-electronics-calibration-compressed.mp4" type="video/mp4"/></video>
<pre><code>
void motorCalibration()
{
  endstopStatus = digitalRead(endstop);
  while (endstopStatus == true)
  {
    // to right
    motorStep(false, 1, 0);
    endstopStatus = digitalRead(endstop);
  }
  motorStep(true, 30, 50);
  endstopStatus = digitalRead(endstop);
  while (endstopStatus == true)
  {
    // to left
    motorStep(true, 1, 0);
    endstopStatus = digitalRead(endstop);
    totalSteps++;
  }
  totalSteps = totalSteps + 30;
  Serial.println(totalSteps);
  // send motor to center
  laneSteps = totalSteps / 4;
  motorStep(false, totalSteps / 2, 50);
}
</code></pre>
<h1 id="positioning">Positioning</h1>
<p>To position correctly the pad according to any crossed lines we had to think about good logic. And the simplest one is always the best.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/machine-design-coding-electronics-logic.jpg"><figcaption></figcaption></figure>
<p>Each <code>lane</code> has a numerical value between 0 and 4 and each <code>line</code> also has a numerical value between 0 and 3.</p>
<p>The game is started with the motor in the centre, in lane <code>2</code>. As soon as a line is crossed, we check whether the value of the line is lower or higher than the value of the lane, which indicates whether the ball is moving to the right or to the left.</p>
<p>Then, knowing the direction and the line crossed, we know in which lane the motor must move. But for how many steps? For the difference between its current position and its final position multiplied by the number of steps that make up a lane.</p>
<p>Let's say that the previous calibration gave us <code>1000 steps</code> between the beginning and the end of the track. We have 5 lanes in our field, which means that each lane has a width of <code>200 steps</code>. If our motor is on lane <code>2</code> and the line <code>3</code> is crossed: 3 is higher than 2, this means that we are going to the right, and the motor has to move on 1 lane (3 - 2), which corresponds to <code>200 steps to the right.</code> And so on.</p>
<video controls="" preload="auto"><source src="medias/machine-design-coding-electronics-moving-with-the-ball.mp4" type="video/mp4"/></video>
<pre><code>
void updatePos(int line)
{
  if (line &lt; position)
  {
    diffPosition = position - line;
    motorStep(true, laneSteps * diffPosition, 50);
    position = line;
  }
  else
  {
    diffPosition = (line + 1) - position;
    motorStep(false, laneSteps * diffPosition, 50);
    position = line + 1;
  }
}
</code></pre>
<h1 id="source-code">Source code</h1>
<p>Here is full code that I wrote to run our prototype.</p>
<pre><code>
// Pong Machine - One side

//   2   4   6   8
// 1 | 3 | 5 | 7 | 9
// ----------------- A

// Stepper motor pins
#define motorEnable 8
#define motorStp 3
#define motorDir 6

// Line pins
#define line0 A2
#define line1 A1
#define line2 A0
#define line3 A3

// Line status
bool line0Status = false;
bool line1Status = false;
bool line2Status = false;
bool line3Status = false;

// Endstop pin
#define endstop 10
int endstopStatus;

// Lanes
int laneNumber = 5;
int totalSteps = 0;
int laneSteps;

// Position
int position = 2;
int diffPosition;
int moveSteps;

void motorStep(bool dir, int steps, int inDelay)
{
  digitalWrite(motorDir, dir);
  delay(inDelay);
  for (int i = 0; i &lt; steps; i++)
  {
    endstopStatus = digitalRead(endstop);
    digitalWrite(motorStp, HIGH);
    delayMicroseconds(800);
    digitalWrite(motorStp, LOW);
    delayMicroseconds(800);
  }
}

void motorCalibration()
{
  endstopStatus = digitalRead(endstop);
  while (endstopStatus == true)
  {
    // to right
    motorStep(false, 1, 0);
    endstopStatus = digitalRead(endstop);
  }
  motorStep(true, 30, 50);
  endstopStatus = digitalRead(endstop);
  while (endstopStatus == true)
  {
    // to left
    motorStep(true, 1, 0);
    endstopStatus = digitalRead(endstop);
    totalSteps++;
  }
  totalSteps = totalSteps + 30;
  Serial.println(totalSteps);
  // send motor to center
  laneSteps = totalSteps / 4;
  motorStep(false, totalSteps / 2, 50);
}

void updatePos(int line)
{
  if (line &lt; position)
  {
    diffPosition = position - line;
    motorStep(true, laneSteps * diffPosition, 50);
    position = line;
  }
  else
  {
    diffPosition = (line + 1) - position;
    motorStep(false, laneSteps * diffPosition, 50);
    position = line + 1;
  }
}

void setup()
{
  Serial.begin(9600);
  delay(1000);
  pinMode(motorEnable, OUTPUT);
  pinMode(motorStp, OUTPUT);
  pinMode(motorDir, OUTPUT);
  pinMode(endstop, INPUT_PULLUP);
  pinMode(line0, INPUT);
  pinMode(line1, INPUT);
  pinMode(line2, INPUT);
  pinMode(line3, INPUT);
  digitalWrite(motorEnable, LOW);
  motorCalibration();
}

void loop()
{
  // Update line status
  line0Status = digitalRead(line0);
  line1Status = digitalRead(line1);
  line2Status = digitalRead(line2);
  line3Status = digitalRead(line3);
  // Update position
  if (line0Status)
  {
    updatePos(0);
  }
  else if (line1Status)
  {
    updatePos(1);
  }
  else if (line2Status)
  {
    updatePos(2);
  }
  else if (line3Status)
  {
    updatePos(3);
  }
}
</code></pre>
<figure class="lg"><img alt="" loading="lazy" src="medias/machine-design-coding-electronics-coding-session.jpg"><figcaption></figcaption></figure>
</section>
<aside>
<p>✎ <span>Created</span> 10/11/2020</p>
<p>⁂ <span>Updated</span> 10/11/2020</p>
</aside>
</article>
</article>
<!-- /content -->
<footer class="footer">
<p>antoine.studio ☼ 2022 — <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> — <a href="https://antoine.studio/rss.xml">RSS Feed</a></p>
</footer>
</main>
<script src="assets/js/scripts.js"></script>
</body>
</html>