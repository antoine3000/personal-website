<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title property="schema:name">antoinejaunard.com - documentation</title>
<meta content="documentation" name="description"/>
<meta content="antoinejaunard.com" property="schema:name"/>
<meta content="documentation" property="schema:description"/>
<link href="assets/main.min.css" rel="stylesheet"/>
</head>
<body class="page page--article">
<main class="main">
<header class="header">
<nav class="nav">
<ul class="nav__list">
<li class="nav__item">
<a class="nav__link" href="index.html">antoinejaunard.com</a>
</li>
<li class="nav__item">
<a class="nav__link" href="content.html">content</a>
</li>
<li class="nav__item">
<a class="nav__link" href="flux.html">flux</a>
</li>
<li class="nav__item">
<a class="nav__link" href="about.html">about</a>
</li>
</ul>
</nav>
</header>
<!-- content -->
<article class="article" id="green-observatory">
<h1 class="article__title">The Green Observatory</h1>
<p class="article__parent">
        This article is part of:
        <a href="fabacademy2020.html">fabacademy2020</a>.
      </p>
<p class="article__tags">Tags:
        
        <a class="tag__link" href="tag-fab-academy-assignments.html">#fab-academy-assignments</a>
</p>
<section class="article__toc">
<h3 class="toc__title--sub"><a href="green-observatory.html#green-observatory-input">Electronics: Input ↓</a></h3>
<h3 class="toc__title--sub"><a href="green-observatory.html#green-observatory-output">Electronics: Output ↓</a></h3>
<h3 class="toc__title--sub"><a href="green-observatory.html#green-observatory-inflatable">Making of the inflatable part ↓</a></h3>
<h3 class="toc__title--sub"><a href="green-observatory.html#green-observatory-structure">Making of the structure ↓</a></h3>
</section>
<section class="article__content ts" id="content">
<h1 id="introduction">Introduction</h1>
<p><em>The Green Observatory</em>, my Fab Academy final project, is a device that listens to the electrical activity of plants and represents it with a physical and meditative movement that we, humans, can observe and contemplate.</p>
<p>I designed, fabricated, programmed and documented this project in Barcelona in 2020. I used open-source software only and so are all my design and fabrication files.</p>
<h1 id="presentation">Presentation</h1>
<video controls="" preload="auto"><source src="medias/green-observatory-presentation-compressed.mp4" type="video/mp4"/></video>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-result-03.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-result-02.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure.jpg"><figcaption></figcaption></figure>
<h1 id="thanks">Thanks</h1>
<p>This project wouldn't have been possible without the precious help of my Fab Academy instructors, Oscar Gonzalez, Eduardo Chamorro Martin and Josep Martí, muchas gracias!</p>
</section>
<footer>
<p>✎ <span>Created</span> 15/06/2020</p>
<p>⁂ <span>Updated</span> 15/06/2020</p>
</footer>
<article class="article--sub" id="green-observatory-input">
<h1 class="article__title">Electronics: Input <a href="green-observatory-input.html">●</a></h1>
<section class="article__content ts">
<h1 id="introduction">Introduction</h1>
<p>An electronic board (low power, 5V) that receives signals from a plant via electrodes placed on its leaves and sends instructions to <a class="external" href="green-observatory-output.html" target="_blank">another board</a> dedicated to the outputs (low power, 12 V). Calculations are performed by a ATmega 16-U2 microchip. The data can be read on a computer via USB.</p>
<h2 id="research">Research</h2>
<p>I have previously researched and created a prototype of what could be an easy setup to (try) listen to the electrical activity of plants. I did this using an Arduino Uno and a 555 IC timer on a breadboard. You can read more on the page dedicated to this topic.</p>
<p><a class="btn" href="final-project-research-input-plant-activity.html">Research / Sensing the electrical activity of a plant</a></p>
<p>I don't know how relevant the data I collect is though, but I feel that detecting any kind of electrical activity from a plant is good for my project.</p>
<p>Don't forget that the main idea of my project is to invite humans to observe nature and to get closer to it. I am not looking for scientific accuracy at all costs, although I would ideally like to achieve it.</p>
<figure class="lg"><img alt="First prototype" loading="lazy" src="medias/green-observatory-input-prototype.jpg"><figcaption>First prototype</figcaption></figure>
<h1 id="key-electronics-components">Key electronics components</h1>
<h2 id="atmega-16-u2">ATmega 16-U2</h2>
<p>After some discussions with my instructors at Fab Lab Barcelona, I decided to test the (poorly documented) <code>ATmega 16-U2</code> chip. It is available in the lab inventory, it speaks USB, has the minimum requirements for my project (and this is the microchip used in the Arduino Uno to exchange data via USB). I always prefer to use appropriate hardware, and especially in this context of custom electronics.</p>
<p>I thought it was a good idea to design my electronics around this chip (but it wasn't). I will talk later about the problems I encountered with the ATmega 16-U2, and why using it might be a bad idea.</p>
<h2 id="resonator-24-mhz">Resonator 24 MHz</h2>
<p>An additional cystal/resonator must be coupled to the ATmega 16-U2 for it to work with USB.
According to Andrew Mao's <a class="external" href="http://fab.cba.mit.edu/classes/863.14/people/andrew_mao/week11/" target="_blank">documentation</a>:</p>
<blockquote>
<p>In order to use Full-speed (12 Mbit/s) USB, the microcontroller needs to be able to generate a precize 48 MHz clock with a deviation of no more than 0.25%. Since resonators have 0.5% tolerance, This means only quartz crystals can be used, and moreover they need to evenly divide into this frequency in order for a phase-locked loop to generate this clock. For the ATmega16U2, this will require a 8MHz or 16MHz crystal - no substitutes.</p>
</blockquote>
<p>Oscar Gonzalez, one of my instructors, recommended that I use a resonator rather than a crystal because it is easier to design and solder, since it is only one piece, than a crystal. A resonator offers an extra precision that I don't need in my project.</p>
<p>Any crystal/resonator that operates at a frequency that is a multiple of 12 should work. It could be a <code>12 MHz</code>, <code>24 MHZ</code> or <code>48 MHz</code>. I opted for the <code>resonator 24 MHz</code> because it is available in the lab's inventory.</p>
<h2 id="mini-usb">Mini USB</h2>
<p>I opted for a mini USB port rather than a micro USB, even if the latter is more used nowadays. The micro USB is so small that it is difficult to solder, but also very fragile. Therefore it is not recommended to use it for prototypes. However, I think it would be better to use it for a final product, simply because people are more likely to already have a cable compatible with it.</p>
<h2 id="555-ic-timer">555 IC Timer</h2>
<p>This component works as a square wave generator and the values it gives can be modified by changing the resistance of the circuit. If the plant has a variation in its electrical activity, its resistance changes and so the square wave generated by the timer.</p>
<p>Update: Neil Gershenfeld, during my final presentation, told me that this component is now obsolete and that every new microchip has its function integrated. To be honest, I'm not sure what to make of his remark, I have to investigate a little more.</p>
<h1 id="design">Design</h1>
<p>I design electronics boards with <a class="external" href="https://kicad-pcb.org/" target="_blank">KiCad</a>, a cross platform and open source electronics design automation suite. You will find the files at the end of this article.</p>
<p>I have already explained how to <a class="external" href="electronics-design.html" target="_blank">design electronics</a> and how to <a class="external" href="electronics-production.html" target="_blank">produce electronics</a>. Feel free to read my documentation on these subjects.</p>
<h2 id="schematics">Schematics</h2>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-03.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-04.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-05.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-06.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-07.png"><figcaption></figcaption></figure>
<h2 id="pcb-design">PCB design</h2>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-01.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-design-02.png"><figcaption></figcaption></figure>
<h2 id="export">Export</h2>
<figure class="md"><img alt="Drills" loading="lazy" src="medias/green-observatory-input-board-low-Drills.png"><figcaption>Drills</figcaption></figure>
<figure class="md"><img alt="Edge cuts" loading="lazy" src="medias/green-observatory-input-board-low-Edge_Cuts.png"><figcaption>Edge cuts</figcaption></figure>
<figure class="md"><img alt="Circuit" loading="lazy" src="medias/green-observatory-input-board-low-F_Cu.png"><figcaption>Circuit</figcaption></figure>
<h3 id="tips">Tips</h3>
<ul>
<li>Verify the correct clearance before tracing the routes</li>
<li>Global deletation &gt; tracks, to delete all the tracks as soon as I'm blocked. It's easier to retrace everything correctly than trying to modify existing tracks that don't work</li>
<li>Clean tracks to make sure there are no unwanted portions of tracks</li>
<li>Trace a common ground at the end of the design process</li>
</ul>
<h1 id="fabrication">Fabrication</h1>
<figure class="md"><img alt="Fresh out of the mini milling machine" loading="lazy" src="medias/green-observatory-input-input-01.jpg"><figcaption>Fresh out of the mini milling machine</figcaption></figure>
<figure class="md"><img alt="My shopping list, just before the soldering" loading="lazy" src="medias/green-observatory-input-input-02.jpg"><figcaption>My shopping list, just before the soldering</figcaption></figure>
<figure class="md"><img alt="A trick solder to solder the microchip without making it move" loading="lazy" src="medias/green-observatory-input-input-03.jpg"><figcaption>A trick solder to solder the microchip without making it move</figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-input-04.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-input-05.jpg"><figcaption></figcaption></figure>
<h2 id="debugging">Debugging</h2>
<p>I thought my electronic board was well made, or at least it looked like it. But once connected to my computer, I first tried to read my USB ports by typing <code>$ lsusb</code> but the new device didn't appear. I then checked further with <code>$ dmesg -w</code> and saw that I had an over-current condition on the new device's port. Which means there is a short somewhere.</p>
<p>I spent hours trying to find the short, but since I have a common ground, meaning that everything except the tracks is ground, it was very difficult to find it.</p>
<p>Finally, I decided to redo my board, but this time whit constant continuity check between each operation, that is the only way to make sure that everything is as it should be.</p>
<figure class="md"><img alt="First and second attempt" loading="lazy" src="medias/green-observatory-input-input-06.jpg"><figcaption>First and second attempt</figcaption></figure>
<p>In the end, I discovered that a track passing under a component was grounded because the clearance I had defined in my design was too small. I scratched a bit the PCB between the track and the common group to separate them, and it worked. That lesson took me hours of work.</p>
<h1 id="atmega-16-u2_1">ATmega 16-U2</h1>
<p>The ATmega 16-U2, as I said before, was supposed to be a good candidate for my electronic project, but it was not.</p>
<p>This chip is the second chip of the Arduino Uno, being there only for the USB protocol, even though this chip is much better than that. But because of this context, all the research that can be done on the Internet on this subject is always drowned under a huge layer of results concerning the Uno. This makes searching for information very difficult, if not impossible.</p>
<p>Also, the datasheet of the ATmega 16-U2 is very cryptic. There is no clear pinout diagram, which is more than useful for programming.</p>
<ul>
<li><a class="external" href="http://ww1.microchip.com/downloads/en/DeviceDoc/doc7799.pdf" target="_blank">ATmega8U2/16U2/32U2 - Complete Datasheet</a></li>
<li><a class="external" href="http://ww1.microchip.com/downloads/en/DeviceDoc/7799S.pdf" target="_blank">ATmega8U2/16U2/32U2 - Summary Datasheet</a></li>
</ul>
<p>And finally, I couldn't find a way to use this chip with the Arduino IDE. This means that I had to program the chip without the Arduino framework, in pure C++ without the function I used to make my prototype like the <code>pulseIn()</code> function. But above all that I can't use the monitor to get feedback on what's going on. This is the most difficult part, it leaves almost no other choice than blind programming, which is the worst when working with sensors.</p>
<h1 id="programmation">Programmation</h1>
<p>As I mentioned above, I had to use other tools than the Arduino or Platformio IDE to program the ATmega 16-U2.</p>
<p>As suggested by <a class="external" href="http://fab.cba.mit.edu/classes/863.14/people/andrew_mao/week11/" target="_blank">Andrew Mao</a> in his very useful documentation, I used <a class="external" href="http://dfu-programmer.github.io/" target="_blank">dfu-programmer</a>. Dfu-programmer is a command line programmer for Atmel chips with a USB bootloader supporting ISP. To do this, the board must be connected via the ISP pins (and unfortunately not the USB).</p>
<p>Two files are needed to send a program via <code>dfu-programmer</code>:</p>
<ol>
<li><code>main.cpp</code> which contains said program</li>
<li><code>Makefile</code>  which contains the instructions for compiling</li>
</ol>
<h2 id="limitations">Limitations</h2>
<p>Due to the lack of debugging tools, it is (almost) impossible to read the values of a sensor and to understand its length, value, frequency, etc. I haven't found a way to do this. I had to leave this part aside. The choice of the ATmega 16-U2 is fatal.</p>
<h2 id="makefile">Makefile</h2>
<p>This the <code>Makefile</code> I used. It tells what the chip is, how the cpp file is called, and different commands such as <code>erase</code>, <code>erase-force</code>, <code>clean</code> and <code>fuse</code> which are shortcuts to get an easier workflow.</p>
<pre>
PROJECT=main
SOURCES=$(PROJECT).cpp

MMCU=atmega16u2
DFU_TARGET=$(MMCU)

F_CPU=8000000

CFLAGS=-mmcu=$(MMCU) -Wall -Os -DF_CPU=$(F_CPU)

$(PROJECT).out: $(SOURCES)
    avr-gcc $(CFLAGS) -I./ -o $(PROJECT).out $(SOURCES)

$(PROJECT).c.hex: $(PROJECT).out
    avr-objcopy -O ihex $(PROJECT).out $(PROJECT).c.hex;\
    avr-size --mcu=$(MMCU) --format=avr $(PROJECT).out

program: $(PROJECT).c.hex
    # dfu-programmer $(DFU_TARGET) flash $(PROJECT).c.hex
    sudo /usr/bin/avrdude -P usb -c avrisp2 -b 9600 -p ATmega16U2 -s -U flash:w:$(PROJECT).c.hex

erase:
    dfu-programmer $(DFU_TARGET) erase

erase-force:
    dfu-programmer $(DFU_TARGET) erase --force

clean: 
    rm $(PROJECT).c.hex $(PROJECT).out

fuse:
    sudo /usr/bin/avrdude -P usb -c avrisp2 -b 9600 -p ATmega16U2 -s -U lfuse:w:0xde:m
</pre>
<h2 id="maincpp">Main.cpp</h2>
<p>This is where the logic comes in.</p>
<p>First I include the libraries, then I define the macros (mini-functions that replace the basics of the Arduino Framework), the constants (pins and port references). Finally, I define the functions that are launched when events occur.</p>
<p>The idea is to simulate a breathing movement with my device. This movement is composed of 4 movements:</p>
<ol>
<li>Inflation</li>
<li>Hold time</li>
<li>Deflation</li>
<li>Hold time</li>
</ol>
<p>So I wrote my code according to this logic. I invite you to read it below. It should be sufficiently documented to be readable.</p>
<h2 id="analog-debugging">Analog debugging</h2>
<p>Since I don't have access to the Arduino monitor to understand what's going on with the electronics, I had to find another way to get feedback. Luckily, I have an LED on my board that I can use as a "morse" signal. I use it in a certain context, if <code>this happens</code> then <code>blink 1 time</code> but if <code>that happens</code> then <code>blink 2 times</code>.</p>
<p>Of course, it's not an ideal workflow, but it helped me a lot to understand my electronic project and to continue programming it. To be honest, I love this kind of low-tech solution.</p>
<pre>
// Include libraries
#include &lt;avr/io.h&gt;
#define F_CPU 8000000
#include &lt;util/delay.h&gt;

// Define macros
#define pinModeOutput(directions, pin) (directions |= pin) // set port direction for output
#define pinModeInput(directions, pin) (directions &amp;= ~pin) // set port direction for output
#define digitalWriteSet(port, pin) (port |= pin)                     // set port pin
#define digitalWriteClear(port, pin) (port &amp;= ~pin)              // clear port pin
#define delay(value) _delay_ms(value)                                            // time delay
// Time related
#define clockCyclesPerMicrosecond() (F_CPU / 1000000L)
#define clockCyclesToMicroseconds(a) ((a) / clockCyclesPerMicrosecond())
#define microsecondsToClockCycles(a) ((a)*clockCyclesPerMicrosecond())

// Define constants
#define port_b PORTB
#define port_c PORTC
#define port_b_dir DDRB
#define port_c_dir DDRC
#define pin_led (1 &lt;&lt; PC4)
#define pin_timer (1 &lt;&lt; PB0)
#define pin_pump (1 &lt;&lt; PB7)
#define pin_sol_1 (1 &lt;&lt; PC7)
#define pin_sol_2 (1 &lt;&lt; PB4)
#define pin_sol_3 (1 &lt;&lt; PB5)
#define pin_sol_4 (1 &lt;&lt; PB6)

// Define variables
unsigned long duration_low;
unsigned long duration_low;
float duty_cycle = 50;

void blink(unsigned long n)
{
    for (unsigned long i = 0; i &lt; n; i++)
    {
        digitalWriteSet(port_c, pin_led);
        _delay_ms(200);
        digitalWriteClear(port_c, pin_led);
        _delay_ms(200);
    }
}

void inflate(int n)
{
    // Start the pump
    digitalWriteSet(port_b, pin_pump);
    // Open valves
    digitalWriteSet(port_b, pin_sol_4);
    digitalWriteSet(port_b, pin_sol_2);
    // Close valves
    digitalWriteClear(port_c, pin_sol_1);
    digitalWriteClear(port_b, pin_sol_3);
    for (unsigned long i = 0; i &lt; n; i++)
    {
        _delay_ms(1);
    }
}

void deflate(unsigned long n)
{
    // Start the pump
    digitalWriteSet(port_b, pin_pump);
    // Open valves
    digitalWriteSet(port_b, pin_sol_3);
    digitalWriteSet(port_c, pin_sol_1);
    // Close valves
    digitalWriteClear(port_b, pin_sol_2);
    digitalWriteClear(port_b, pin_sol_4);
    for (unsigned long i = 0; i &lt; n; i++)   
    {
        _delay_ms(1);
    }
}

void hold(int n)
{
    // close
    digitalWriteClear(port_b, pin_pump);
    digitalWriteClear(port_c, pin_sol_1);
    digitalWriteClear(port_b, pin_sol_2);
    digitalWriteClear(port_b, pin_sol_3);
    digitalWriteClear(port_b, pin_sol_4);
    for (unsigned long i = 0; i &lt; n; i++)
    {
        _delay_ms(1);
    }
}

void breathe(int time)
{
    // unsigned long loops = microsecondsToClockCycles(time);
    unsigned long inflate_loops = time / 100 * 62;
    unsigned long holdup_loops = time / 100 * 5;
    unsigned long holddown_loops = time / 100 * 5;
    unsigned long deflate_loops = time / 100 * 28;
    inflate((int)inflate_loops);
    hold((int)holdup_loops);
    deflate((int)deflate_loops);
    hold((int)holddown_loops);
}

// Measure pulses
unsigned long pulseIn(char pin, bool state, long unsigned int timeout)
{
    unsigned long max_loops = microsecondsToClockCycles(timeout);
    unsigned long average_low = 0;
    unsigned long average_low = 0;
    unsigned long total_low = 0;
    unsigned long total_low = 0;
    for (long unsigned int i = 0; i &lt; max_loops; i++)
    {
        if (pin)
        {
            total_low++;
        }
        else
        {
            total_low++;
        }
    }
    average_low = total_low / max_loops;
    average_low = total_low / max_loops;
    if (state)
    {
        return average_low;
    }
    else
    {
        return average_low;
    }
}

// Main Function
int main(void)
{
    _delay_ms(200);

    // Initialize LED
    pinModeOutput(port_c_dir, pin_led);
    port_c_dir |= pin_led;
    port_c &amp;= ~pin_led;
    digitalWriteClear(port_c, pin_led);
    // Initialize Timer pin
    pinModeInput(port_b_dir, pin_timer);
    port_b_dir |= pin_led;
    port_b &amp;= ~pin_timer;
    digitalWriteClear(port_b, pin_timer);
    // Initialize Pump pin
    pinModeOutput(port_b_dir, pin_pump);
    port_b_dir |= pin_pump;
    port_b &amp;= ~pin_pump;
    digitalWriteClear(port_b, pin_pump);
    // Initialize Solenoid 1 pin
    pinModeOutput(port_c_dir, pin_sol_1);
    port_c_dir |= pin_sol_1;
    port_c &amp;= ~pin_sol_1;
    digitalWriteClear(port_c, pin_sol_1);
    // Initialize Solenoid 2 pin
    pinModeOutput(port_b_dir, pin_sol_2);
    port_b_dir |= pin_sol_2;
    port_b &amp;= ~pin_sol_2;
    digitalWriteClear(port_b, pin_sol_2);
    // Initialize Solenoid 3 pin
    pinModeOutput(port_b_dir, pin_sol_3);
    port_b_dir |= pin_sol_3;
    port_b &amp;= ~pin_sol_3;
    digitalWriteClear(port_b, pin_sol_3);
    // Initialize Solenoid 4 pin
    pinModeOutput(port_b_dir, pin_sol_4);
    port_b_dir |= pin_sol_4;
    port_b &amp;= ~pin_sol_4;
    digitalWriteClear(port_b, pin_sol_4);

    // Loop
    while (1)
    {
        breathe(20000);
        // blink(4);
        // _delay_ms(1400);
    }
}

</pre>
<h1 id="result">Result</h1>
<p>Here is a video shot of my final project, where you can see the inflatable part reacting to the electronics. As I said before, it doesn't react to the activity of the plan but to the operations I wrote previously in the code. This makes it more of a <em>proof of concept</em> than a functional part.</p>
<video controls="" preload="auto"><source src="medias/green-observatory-input-electronics-detail-muted.mp4" type="video/mp4"/></video>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-input-final-result.png"><figcaption></figcaption></figure>
<h1 id="conclusion">Conclusion</h1>
<p>I had a lot of trouble programming the chip I chose, the Atmega 16-U2. Especially because my prototype works and I couldn't reproduce its behavior on my custom electronics due to the lack of debugging tools.</p>
<p>Saying that I learned a lot in the process about how to react, debug, bounce back to other solutions, what USB is, how it works, etc. It made me realize how dependent we can be on tools that make our lives easier, like the Arduino IDE. And I'm very happy about that.</p>
<p>How boring would a project be if everything worked as planned, right? </p>
<h1 id="files">Files</h1>
<ul>
<li>Kicad electronics design files: <a class="external" href="file:green-observatory.zip" target="_blank">green-observatory.zip</a></li>
<li>Green observatory - Electronics design: <a class="external" href="https://gitlab.com/antoinestudio/green-observatory" target="_blank">Gitlab repository</a></li>
<li>Green observatory - Logic (code): <a class="external" href="https://gitlab.com/antoinestudio/green-observatory-logic" target="_blank">Gitlab repository</a></li>
<li>Fabrication file: <a class="external" href="file:board-low-Drills.png" target="_blank">board-low-Drills.png</a> + <a class="external" href="file:board-low-Drills.rml" target="_blank">board-low-Drills.rml</a></li>
<li>Fabrication file: <a class="external" href="file:board-low-Edge_Cuts.png" target="_blank">board-low-Edge_Cuts.png</a> + <a class="external" href="file:board-low-Edge_Cuts.rml" target="_blank">board-low-Edge_Cuts.rml</a></li>
<li>Fabrication file: <a class="external" href="file:board-low-F_Cu.png" target="_blank">board-low-F_Cu.png</a> + <a class="external" href="file:board-low-F_Cu.rml" target="_blank">board-low-F_Cu.rml</a></li>
</ul>
</section>
<aside>
<p>✎ <span>Created</span> 16/06/2020</p>
<p>⁂ <span>Updated</span> 12/10/2020</p>
</aside>
</article>
<article class="article--sub" id="green-observatory-output">
<h1 class="article__title">Electronics: Output <a href="green-observatory-output.html">●</a></h1>
<section class="article__content ts">
<h1 id="introduction">Introduction</h1>
<p>An electronic board that receives signals from <a class="external" href="green-observatory-input.html" target="_blank">an input</a> and controls an air fhigh using an air pump and four solenoids.</p>
<p>Note that this project is inspired by <a class="external" href="https://www.programmableair.com/" target="_blank">Programmable Air</a>, I simplified it by using one pump instead of two. Once again, thanks to open-source :)</p>
<figure class="md"><img alt="First sketch" loading="lazy" src="medias/green-observatory-output-schema.jpg"><figcaption>First sketch</figcaption></figure>
<h1 id="key-electronics-components">Key electronics components</h1>
<h2 id="air-pump">Air pump</h2>
<p>The <a class="external" href="https://www.sparkfun.com/products/10398" target="_blank">air pump</a> operates at 12V and has sufficient suction for my project. The only drawback is that it is very noisy. It will not produce the complete meditative experience I am looking for, but it will work for this first prototype. This pump was available at the lab.</p>
<h2 id="solenoids">Solenoids</h2>
<p>The four CJV23 solenoids (<a class="external" href="file:CJV23.pdf" target="_blank">datasheet</a>) are the same as those used in the Programmable Air project. I took it as a reference because it's not so easy to find valves for air circuits (and not for water). I found them on <a class="external" href="https://www.ebay.es/itm/324162624034" target="_blank">ebay</a>.</p>
<h2 id="buck-boost">Buck-boost</h2>
<p>I use a buck-boost from <a class="external" href="https://www.adafruit.com/product/2190" target="_blank">Adrafuit</a> (which was available at the lab) to convert 12V (input) to 5V (output). this alhighs me to power the high voltage circuit from this high voltage board.</p>
<h1 id="design">Design</h1>
<p>I design electronics boards with <a class="external" href="https://kicad-pcb.org/" target="_blank">KiCad</a>, a cross platform and open source electronics design automation suite. You will find the files at the end of this article.</p>
<p>I have already explained how to <a class="external" href="electronics-design.html" target="_blank">design electronics</a> and how to <a class="external" href="electronics-production.html" target="_blank">produce electronics</a>. Feel free to read my documentation on these subjects.</p>
<h2 id="schematics">Schematics</h2>
<figure class="md"><img alt="Misc." loading="lazy" src="medias/green-observatory-output-design-01.png"><figcaption>Misc.</figcaption></figure>
<figure class="md"><img alt="Solenoids" loading="lazy" src="medias/green-observatory-output-design-02.png"><figcaption>Solenoids</figcaption></figure>
<figure class="md"><img alt="Mosfets" loading="lazy" src="medias/green-observatory-output-design-03.png"><figcaption>Mosfets</figcaption></figure>
<figure class="md"><img alt="Pump (identical to solenoids)" loading="lazy" src="medias/green-observatory-output-design-04.png"><figcaption>Pump (identical to solenoids)</figcaption></figure>
<h2 id="pcb-design">PCB design</h2>
<figure class="lg"><img alt="" loading="lazy" src="medias/green-observatory-output-design-05.png"><figcaption></figcaption></figure>
<figure class="lg"><img alt="" loading="lazy" src="medias/green-observatory-output-design-06.png"><figcaption></figcaption></figure>
<h2 id="export">Export</h2>
<figure class="md"><img alt="Drills" loading="lazy" src="medias/green-observatory-output-board-high-Drills.png"><figcaption>Drills</figcaption></figure>
<figure class="md"><img alt="Edge cuts" loading="lazy" src="medias/green-observatory-output-board-high-Edge_Cuts.png"><figcaption>Edge cuts</figcaption></figure>
<figure class="md"><img alt="Circuit" loading="lazy" src="medias/green-observatory-output-board-high-F_Cu.png"><figcaption>Circuit</figcaption></figure>
<h1 id="fabrication">Fabrication</h1>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-output-fabrication-01.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-output-fabrication-02.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="High and low voltage together" loading="lazy" src="medias/green-observatory-output-fabrication-03.jpg"><figcaption>High and low voltage together</figcaption></figure>
<h1 id="problems-encountered">Problems encountered</h1>
<p>Also, when designing the PCB, I chose a wrong mosfet element. When I realized this, I replaced the symbol I was using in the schematics but I didn't update the footprint. Therefore, after milling and soldering the PCB, I realized that the mosfets were not connected as they should be. To avoid redoing everything (the Fab Academy deadline was too short), I had to use another type of mosfets with long legs that can be bent in the right position.  An unaesthetic technique that works.</p>
<p>Unfortunately, powering my circuit with these wrong mosfets burned the buck-boost. It was no big deal, because it was used to power <a class="external" href="green-observatory-input.html" target="_blank">another board</a> that could also be powered by USB. I'll try to replace the buck-boost with a <a class="external" href="https://en.wikipedia.org/wiki/Small-outline_transistor" target="_blank">SOT</a> (small outline transistor), it should be cheaper and easier to use.</p>
<h1 id="result">Result</h1>
<p>To see a video of the final result -&gt; <a class="external" href="green-observatory-presentation.html" target="_blank">Green Observatory - Presentation</a></p>
<figure class="lg"><img alt="" loading="lazy" src="medias/green-observatory-output-electronics.jpg"><figcaption></figcaption></figure>
<h1 id="conclusion">Conclusion</h1>
<p>I'm very happy with the result of this PCB. Even with this Frankenstein look, because of the replacement of the mosfets.</p>
<p>Of course, I would like to redo it more cleanly, now that I've understood the mistakes I made, but in doing so I would be very tempted to change something: I would love to have a silent system. But that would mean a smaller pump (5V) and therefore less suction, which means a smaller inflatable, a smaller device. I keep this option in mind, as a V2 of this project.</p>
<h1 id="files">Files</h1>
<ul>
<li>Kicad electronics design files: <a class="external" href="file:green-observatory.zip" target="_blank">green-observatory.zip</a></li>
<li>Green observatory - Electronics design: <a class="external" href="https://gitlab.com/antoinestudio/green-observatory" target="_blank">Gitlab repository</a></li>
<li>Green observatory - Logic (code): <a class="external" href="https://gitlab.com/antoinestudio/green-observatory-logic" target="_blank">Gitlab repository</a></li>
<li>Fabrication file: <a class="external" href="file:board-high-Drills.png" target="_blank">board-high-Drills.png</a> + <a class="external" href="file:board-high-Drills.rml" target="_blank">board-high-Drills.rml</a></li>
<li>Fabrication file: <a class="external" href="file:board-high-Edge_Cuts.png" target="_blank">board-high-Edge_Cuts.png</a> + <a class="external" href="file:board-high-Edge_Cuts.rml" target="_blank">board-high-Edge_Cuts.rml</a></li>
<li>Fabrication file: <a class="external" href="file:board-high-F_Cu.png" target="_blank">board-high-F_Cu.png</a> + <a class="external" href="file:board-high-F_Cu.rml" target="_blank">board-high-F_Cu.rml</a></li>
</ul>
</section>
<aside>
<p>✎ <span>Created</span> 17/06/2020</p>
<p>⁂ <span>Updated</span> 12/10/2020</p>
</aside>
</article>
<article class="article--sub" id="green-observatory-inflatable">
<h1 class="article__title">Making of the inflatable part <a href="green-observatory-inflatable.html">●</a></h1>
<section class="article__content ts">
<p>An important part of my final project is the inflatable part, which will help us understand the electrical activity of plants. This part should produce organic movements that react to a flow of air.</p>
<p>So I have to produce a silicone part that has an air pocket inside that could be inflated and deflated by pushing and pulling a flow of air inside through two pipes (in and out).</p>
<h1 id="strategy">Strategy</h1>
<p>The strategy that Eduardo Chamorro (one of my instructors) and I came up with is to build a mold using a piece of laser-cut acrylic to cast a first layer of silicon and then redo another layer while inserting another piece of acrylic that will allow us to preserve an air pocket inside the cast silicon piece.</p>
<ul>
<li>Design a structure that can be lasercutted</li>
<li>Plan which parts will be added and/or removed during the casting process</li>
<li>Keep in mind how the air will circulate</li>
</ul>
<h1 id="design">Design</h1>
<p>I designed the mold using Freecad and parametric values. The shape of this inflatable part is given by the overall <a class="external" href="green-observatory-structure.html" target="_blank">structure</a>.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-design-screenshot-1.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-design-screenshot-2.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-lasercut-plan.png"><figcaption></figcaption></figure>
<h1 id="fabrication">Fabrication</h1>
<h2 id="lasercutting">Lasercutting</h2>
<p>The cutting of the <code>5 mm</code> thick acrylic sheet was very fast. Indeed, nothing fancy here, only cuts.</p>
<h3 id="settings">Settings</h3>
<ul>
<li><code>95%</code> power</li>
<li><code>0.45</code> time</li>
<li><code>20000 Hz</code> frequency</li>
</ul>
<video controls="" preload="auto"><source src="medias/green-observatory-inflatable-inflatable-process-01.mp4" type="video/mp4"/></video>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-02.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-03.jpg"><figcaption></figcaption></figure>
<h3 id="corrections">Corrections</h3>
<p>I used the exact diameter of the pipes (the two holes in the middle disk) in my design and, of course, the pipes did not fit into the laser-cut holes. I had to redo them using the hand drill. This step was actually quite fast and accurate, but it could have been avoided in the design. <strong>Practice makes experience, experience makes practice</strong>.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-04.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-05.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-06.jpg"><figcaption></figcaption></figure>
<p>Now that my mold is ready, let's go to the next step and play with silicon.</p>
<h2 id="casting">Casting</h2>
<p>The idea here is to cast two times, by flipping the part over and changing the position of the central disk between the two steps.</p>
<p>I will use the same silicon, Easyplat 00-40, that I used to make the mold of my oloids during the week of <em>molding and casting</em>.  Much of the following process has already been explored during the that week, I invite you to read it for more information.</p>
<figure class="md"><img alt="Easyplat 00-40" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-15.jpg"><figcaption>Easyplat 00-40</figcaption></figure>
<p><a class="btn" href="molding-casting-multiples-oloids.html">molding and casting</a></p>
<figure class="md"><img alt="Quick sketch of the casting process" loading="lazy" src="medias/green-observatory-inflatable-drawing-process.jpg"><figcaption>Quick sketch of the casting process</figcaption></figure>
<h3 id="first-step">First step</h3>
<p>The first step consists of using the mold with the disc fixed in the center and filling it with a layer of silicone.</p>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-07.jpg"><figcaption></figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-08.jpg"><figcaption></figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-09.jpg"><figcaption></figcaption></figure>
<figure class="lg"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-16.jpg"><figcaption></figcaption></figure>
<figure class="lg"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-17.jpg"><figcaption></figcaption></figure>
<p>As you can see, I used two acrylic sticks pushed into the holes of the disc to make sure that the silicon cannot block future air passages.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-11.jpg"><figcaption></figcaption></figure>
<h3 id="second-step">Second step</h3>
<p>Then for the second step, I removed the disk in the middle, fliped the silicon piece and put the disk in the center again. I then poured a thin layer of silicon on top of it. Remember that the idea is to capture the acrylic disc in the middle of the silicone while keeping empty spaces for air circulation.</p>
<ul>
<li>Unscrew the structure and flip the mold</li>
<li>Clean everything</li>
<li>Place the disc in the center, on the first silicon layer.</li>
<li>glue the holes (with transparent adhesive tape)</li>
<li>Calculate the new volume to be cast, and prepare the silicon mixture</li>
<li>Pour and try to reach a thickness of about 1.5 mm.</li>
</ul>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-19.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-14.jpg"><figcaption></figcaption></figure>
<p>The ideal thickness is between <code>1 mm</code> to <code>2.5 mm</code>. The thinner it is, the flexer but also more fragile it will be. This step may require several tests.</p>
<h3 id="corrections_1">Corrections</h3>
<p>Silicon is a very tolerant material. Errors can (almost) always be corrected.</p>
<ul>
<li>If the mixing has not been done correctly, the silicon will not stick. It is then easy to peel it off and redo the step that went wrong.</li>
<li>If the top layer is too thin and therefore fragile, simply cover it with another thin layer to complete it. The two layers of silicon will merge and leave no trace.</li>
<li>If the top layer is too thick and you see it before it is completely dry, peel it off, clean it and start again.</li>
</ul>
<h3 id="mistakes-encountered">Mistakes encountered</h3>
<ul>
<li>When mixing the silicon, I calculated the volume needed to fill the mold without subtracting the internal parts, I ended up with a waste of silicon (which is expensive)</li>
<li>I used white masking tape in the first version I did, which was much too visible and therefore un-aesthetic</li>
<li>During my first attempt, the second layer of silicone was too thin, the inflation worked but I tore the membrane</li>
</ul>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-inflatable-inflatable-process-20.jpg"><figcaption></figcaption></figure>
<h1 id="result">Result</h1>
<p>I'm super happy with the result. The silicon piece I produced got the texture I imagined and can easily be inflated/deflated. Here I'm blowing to activate the movement but the idea is to then automate this movement with an air pump.</p>
<video controls="" preload="auto"><source src="medias/green-observatory-inflatable-inflatable-process-18.mp4" type="video/mp4"/></video>
<figure class="md"><img alt="the inflatable part mounted on my final project" loading="lazy" src="medias/green-observatory-inflatable-inflatable-result.jpg"><figcaption>the inflatable part mounted on my final project</figcaption></figure>
<h1 id="conclusion">Conclusion</h1>
<p>The fabrication of inflatables using laser-cut parts and silicone makes it possible to think differently about what is feasible in a Fab Lab. Playing with air and silicon almost directly gives an organic movement that can then bring any type of project to life.</p>
<p>I think this kind of technique, and the whole field of soft robotics, needs to be explored further. It can bridge the gap that separates us humans from the messages conveyed by technology.</p>
<h1 id="files">Files</h1>
<ul>
<li>Design file: <a class="external" href="file:inflatable.FCStd" target="_blank">inflatable.FCStd</a></li>
<li>Production file: <a class="external" href="file:inflatable-acrylic-5mm.dxf" target="_blank">inflatable-acrylic-5mm.dxf</a></li>
</ul>
</section>
<aside>
<p>✎ <span>Created</span> 18/06/2020</p>
<p>⁂ <span>Updated</span> 07/10/2020</p>
</aside>
</article>
<article class="article--sub" id="green-observatory-structure">
<h1 class="article__title">Making of the structure <a href="green-observatory-structure.html">●</a></h1>
<section class="article__content ts">
<p>The structure was designed with <a class="external" href="https://www.freecadweb.org/" target="_blank">Freecad</a> and made to be milled with a CNC machine on a 9mm thick plywood panel. The upper disk supports the inflatable part and the lower disk supports the electronics. A 3D printed part ensures the desired angle of the structure.</p>
<h1 id="design">Design</h1>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-01.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-03.png"><figcaption></figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-02.png"><figcaption></figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-04.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-06.png"><figcaption></figcaption></figure>
<p>The keys, the parts that lock the structure, are not straight but have a small angle to be able to drive them into the other part.</p>
<figure class="md"><img alt="Small angle" loading="lazy" src="medias/green-observatory-structure-design-07.png"><figcaption>Small angle</figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-08.png"><figcaption></figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-09.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="Space for cable management" loading="lazy" src="medias/green-observatory-structure-design-10.png"><figcaption>Space for cable management</figcaption></figure>
<figure class="md"><img alt="3D printed connector" loading="lazy" src="medias/green-observatory-structure-design-05.png"><figcaption>3D printed connector</figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-11.png"><figcaption></figcaption></figure>
<figure class="sm"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-12.png"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-design-13.png"><figcaption></figcaption></figure>
<h1 id="fabrication">Fabrication</h1>
<h2 id="prototype">Prototype</h2>
<p>I wanted to see my project out of my computer to make sure I was designing it with good proportions before I cut it with the CNC on a wood board. To do this, I lasercut a tiny prototype on cardboard.</p>
<p>Cardboard is the cheapest and most environmentally friendly material available in Fab Labs, making it the best material for prototyping.</p>
<p>That step gave me the "green light" to fabricate my project real size.</p>
<figure class="md"><img alt="Cardboard prototype" loading="lazy" src="medias/green-observatory-structure-prototype.jpg"><figcaption>Cardboard prototype</figcaption></figure>
<h2 id="real-size">Real size</h2>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-cnc-01.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-cnc-02.jpg"><figcaption></figcaption></figure>
<h1 id="result">Result</h1>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-result-03.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-result-04.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-result-02.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-result-05.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-result-06.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-screws.jpg"><figcaption></figcaption></figure>
<figure class="md"><img alt="" loading="lazy" src="medias/green-observatory-structure-result-01.jpg"><figcaption></figcaption></figure>
<h1 id="files">Files</h1>
<ul>
<li>Freecad design file - <a class="external" href="file:structure_FAB.FCStd" target="_blank">structure_FAB.FCStd</a></li>
<li>Structure DXF file - <a class="external" href="file:structure_dogbones.dxf" target="_blank">structure_dogbones.dxf</a></li>
<li>Connector STL file - <a class="external" href="file:connector.stl" target="_blank">connector.stl</a></li>
</ul>
</section>
<aside>
<p>✎ <span>Created</span> 19/06/2020</p>
<p>⁂ <span>Updated</span> 18/10/2020</p>
</aside>
</article>
</article>
<!-- /content -->
<footer class="footer">
<p>antoinejaunard.com ☼ 2022 — <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> — <a href="https://antoinejaunard.com/rss.xml">RSS Feed</a> — <a href="https://merveilles.town/@focus404" rel="me">Mastodon</a></p>
</footer>
</main>
</body>
</html>