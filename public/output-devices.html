<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title property="schema:name">antoinejaunard.com - documentation</title>
<meta content="documentation" name="description"/>
<meta content="antoinejaunard.com" property="schema:name"/>
<meta content="documentation" property="schema:description"/>
<link href="assets/main.min.css" rel="stylesheet"/>
</head>
<body class="page page--article">
<main class="main">
<header class="header">
<nav class="nav">
<ul class="nav__list">
<li class="nav__item">
<a class="nav__link" href="index.html">antoinejaunard.com</a>
</li>
<li class="nav__item">
<a class="nav__link" href="content.html">content</a>
</li>
<li class="nav__item">
<a class="nav__link" href="about.html">about</a>
</li>
</ul>
</nav>
</header>
<!-- content -->
<article class="article" id="output-devices">
<h1 class="article__title">Output devices</h1>
<p class="article__parent">
    This article is part of:
    <a href="fabacademy2020.html">fabacademy2020</a>.
  </p>
<section class="article__toc">
<h3 class="toc__title">
<a href="output-devices.html#output-devices-incubator">Prototyping an incubator ↓</a>
</h3>
</section>
<section class="article__content ts" id="content">
<p>This week's assignement is about output devices: we are learning how to make various motors work, what are their mechanisms and principles, when and why use a specific one instead of another.</p>
<p>I'm going to lend a hand to <a class="external" href="https://maudb.gitlab.io/dok/" target="_blank">Maud Bausier</a>, my partner, who is building an incubator to grow mycelium or any fermented food (tempeh, sriracha, etc.). I think we could have enough material to finish a prototype at home (covid-19 restrictions).</p>
<p>The main challenges for the moment concern electronics, which consists of: a thermistor (to know the temperature inside the incubator), a Peltier (to heat it), a fan (to cool it), an LCD screen (to know what's going on) and two push buttons to set the desired temperature inside the incubator.</p>
<figure class="md"><img alt="incubator prototype" loading="lazy" src="medias/output-devices-incubator-overview.jpg"><figcaption>incubator prototype</figcaption></figure>
<hr/>
<p>Part of this assignment is also covered on my final project's page.</p>
<p><a class="btn" href="green-observatory-output.html">The Green Observatory: Output</a></p>
<hr/>
<h1 id="motors">Motors</h1>
<p>But first, I needed some basics about motors: a motor is mainly made of coils and magnets. When current goes through a coil, a magnetic field is generated around it. The higher the current, the greater the field. This magnetic field creates polarity which is used to create a rotational force. This force is called <a class="external" href="https://en.wikipedia.org/wiki/Torque" target="_blank">the torque</a> and its value depends on the motor's input current. More current implies stronger magnetic field in the coils, that means more attraction/repulsion.</p>
<figure class="md"><img alt="motor coils" loading="lazy" src="medias/output-devices-motor-coils.png"><figcaption>motor coils</figcaption></figure>
Image source: <a class="external" href="https://itp.nyu.edu/physcomp/lessons/dc-motors/dc-motors-the-basics/" target="_blank">ITP Physical Computing</a></p>
<h2 id="dc-motor">DC motor</h2>
<p>Maybe the simplest and most common motor in electronics, it converts current electrical energy into mechanical energy. The motor spins in one direction. Switching its polarity changes its direction. Varying the current supplied varies the speed of the motor.</p>
<p>There are two main kinds of DC motor: the brushed one and the brushless one. The first one is more commonly used because it is the cheaper one. The brushless is bit more expensive, but it is less noisy and can last a lot longer because it doesn't need to be maintained, simply because there is almost no friction inside it.</p>
<figure class="md"><img alt="DC brush motor" loading="lazy" src="medias/output-devices-dc-brush.jpg"><figcaption>DC brush motor</figcaption></figure>
Image source: <a class="external" href="https://learn.sparkfun.com/tutorials/motors-and-selecting-the-right-one#what-makes-a-motor-move-" target="_blank">Sparkfun: Motors and selecting the right one</a></p>
<h2 id="stepper-motor">Stepper motor</h2>
<blockquote>
<p>Stepper motors are different than regular DC motors in that they don’t turn continuously, but move in a series of steps. A stepper motor is a motor that has multiple coils, not just one. By energizing each coil in sequence, you attract the shaft magnets to each coil in the sequence, and you can turn the motor in precise steps, rather than simply rotating continually.</p>
</blockquote>
<figure class="md"><img alt="stepper motor" loading="lazy" src="medias/output-devices-stepper-motor.jpg"><figcaption>stepper motor</figcaption></figure>
<p>Source: <a class="external" href="https://itp.nyu.edu/physcomp/lessons/dc-motors/dc-motors-the-basics/" target="_blank">ITP Physical Computing</a></p>
<h2 id="servo">Servo</h2>
<blockquote>
<p>A Servo is a small device that has an output shaft. This shaft can be positioned to specific angular positions by sending the servo a coded signal. As long as the coded signal exists on the input line, the servo will maintain the angular position of the shaft. As the coded signal changes, the angular position of the shaft changes.</p>
<blockquote>
<p><a class="external" href="http://www.seattlerobotics.org/guide/servos.html" target="_blank">Seattle Robotic Society</a></p>
</blockquote>
</blockquote>
<figure class="md"><img alt="Servo motor" loading="lazy" src="medias/output-devices-servo-motor.jpg"><figcaption>Servo motor</figcaption></figure>
Image source: <a class="external" href="https://www.youtube.com/watch?v=LXURLvga8bQ" target="_blank">How Servo Motors Work &amp; How To Control Servos using Arduino</a></p>
<p>As we can see on the image above, a servo motor is composed by a DC motor, a potentionmeter and embedded circuit to control them.</p>
<p>Servo motor appears to be the perfect candidate when we need a full control of the rotation angle, direction and speed of a motor.</p>
<h1 id="mosfet">MOSFET</h1>
<p>A MOSFET (Metal Oxide Semiconductor Field Effect Transistor) is a semiconductor device which is used for switching electronic signals.</p>
<p class="todo">To do: MOSFET description</p>
<h1 id="lcd-screen">LCD screen</h1>
<p class="todo">To do: LCD screen description</p>
</section>
<footer>
<p>✎ <span>Created</span> 15/04/2020</p>
<p>⁂ <span>Updated</span> 02/11/2020</p>
<a class="btn-vscode hidden" href="vscode://file/Users/antoine/repo/websites/personal-website/content/2020-09-01-fabacademy2020/2020-04-15-output-devices/_index.md">↗ vscode</a>
</footer>
<article class="article--sub" id="output-devices-incubator">
<h1 class="article__title">
      Prototyping an incubator <a href="output-devices-incubator.html">●</a>
</h1>
<section class="article__content ts">
<p>As I said, my partner is building an incubator to help us grow mycellium (and other fermented food) and she asked me an hand to help her with the electronic part. In this context, I will prototype an incubator by using the devices I already have. I will do it by following the spiral methodology: a first round with the basic features, and then other ones with additional options.</p>
<h2 id="update-2020-11">Update 2020-11</h2>
<p>I have started a new project dedicated to the incubator and the sub-projects it brings. Everything is documented under <a class="external" href="incubator-v0-1.html" target="_blank">incubator-v0-1.html</a>.</p>
<figure class="md"><img alt="" loading="lazy" src="medias/output-devices-incubator-incubator-shield.jpg"><figcaption></figcaption></figure>
<p><a class="btn" href="incubator-v0-1.html">Incubator</a></p>
<h2 id="round-01-the-basics">Round #01: the basics</h2>
<p>For the first round, I would like to control a fan and a Peltier (thermoelectric cooler) to get an ideal temperature into a closed space, using a Arduino UNO. The Peltier will be used to warm up the temperature and the fan will help us to either cool down or to distribute the heat evenly.</p>
<blockquote>
<p>Thermoelectric coolers (TEC or Peltier) create a temperature differential on each side. One side gets hot and the other side gets cool. Therefore, they can be used to either warm something up or cool something down, depending on which side you use.</p>
<blockquote>
<p><a class="external" href="https://www.sparkfun.com/products/15082" target="_blank">Sparkfun - Thermoelectric Cooler</a></p>
</blockquote>
</blockquote>
<p>The Peltier could be used to warm up or cool down the space depending on the wanted temperature, to do so, we apparently have to reverse its polarity. I will try to explore this track later. I will focus on the warm side for now.</p>
<p>Because the fan and the Peltier device require a voltage of 12V and the arduino can only supply 5V, I added an external power supply in the circuit. It is then necessary to also include MOSFETs to control how and when the current flows through the devices.</p>
<h3 id="material">Material</h3>
<ul>
<li>Arduino UNO (<a class="external" href="https://content.arduino.cc/assets/Pinout-UNOrev3_latest.pdf" target="_blank">pinout</a>)</li>
<li>Thermoelectric Cooler (<a class="external" href="https://www.sparkfun.com/products/15082" target="_blank">info</a> / <a class="external" href="https://cdn.sparkfun.com/assets/a/d/2/a/7 TEC112707Thermoelectric_Module_Datasheet.pdf" target="_blank">datasheet</a>)</li>
<li>12V Axial Fan (EverFlow R127025BU DC 12V 0.40AMP 4-pin connector)</li>
<li>10K thermistor</li>
<li>MOSFET N-CH (<a class="external" href="https://media.digikey.com/pdf/Data%20Sheets/NXP%20PDFs/IRFZ44N_Rev1.pdf" target="_blank">datasheet</a>)</li>
<li>12V external supply</li>
<li>10K resistors</li>
<li>Diode</li>
</ul>
<h3 id="schematics">Schematics</h3>
<p>I did a schematic in <a class="external" href="https://www.kicad-pcb.org/" target="_blank">KiCAD</a> to help me understand the different components ad how to plug them together. Here is a <a class="external" href="files/incubator-schema.jpg" target="_blank">larger image</a> if you like.</p>
<figure class="md"><img alt="incubator-schema" loading="lazy" src="medias/output-devices-incubator-incubator-schema.jpg"><figcaption>incubator-schema</figcaption></figure>
<p>File: <a class="external" href="files/incubator_01.pro" target="_blank">incubator_01.pro</a></p>
<figure class="md"><img alt="incubator prototype" loading="lazy" src="medias/output-devices-incubator-incubator-circuit.jpg"><figcaption>incubator prototype</figcaption></figure>
<h3 id="code">Code</h3>
<p>I attribute the pins values according to my schematics and define some settings, such as the ideal temperature and the accepted range, but also the fan and Peltier power.</p>
<p>I do not want the system to go from a stage "It is too hot, I have to cool the temperature" to a stage "It is too cold, let's heat it now" too quickly. This is why I implemented the value <code>tempRange</code>, saying that there are acceptable values around the ideal, which makes the system less reactive but constant.</p>
<p>The fan and the Peltier do not have to operate at their maximum value all the time. This is why I plugged them on PWM pins, to be more subtle than just <code>HIGH</code> and <code>LOW</code> values. A pulse-width modulation (PWM) pin allow us to simulate an analog behavior by manipulating the frequency of the signal (read the <a class="external" href="https://www.arduino.cc/en/Tutorial/SecretsOfArduinoPWM" target="_blank">Secrets of Arduino PWM</a>).</p>
<p>In addition, I introduced the values <code>powerFan</code> and<code>powerPeltier</code>, by mapping a value between 0 and 99 (easier to manipulate) to the real value going from 0 to 255 (analog style), to declare the necessary power to both devices. According to the test I did, a value between 20 and 40 is sufficient and prevents the system from overheating, damaging the wires or the devices.</p>
<pre>
// PINS
int pinFan = 3;
int pinPeltier = 5;
int pinThermo = 0;
// VARIABLES
int val;
float temp;
// SETTINGS
int powerFan = 20; // 0-99
int powerPeltier = 30; // 0-99
int tempIdeal = 28;
int tempRange = 2;

void setup() {
  Serial.begin(9600);
  pinMode(pinFan, OUTPUT);
  pinMode(pinPeltier, OUTPUT);
}

void thermistor(int RawADC) {
  temp = log(((10240000/RawADC) - 10000));
  temp = 1 / (0.001129148 + (0.000234125 + (0.0000000876741 * temp * temp ))* temp );
  temp = temp - 273.15;
}

void loop(){
  int levelPeltier = map(powerPeltier, 0, 99, 0, 255);
  int levelFan = map(powerFan, 0, 99, 0, 255);
  int a = analogRead(pinThermo);
  thermistor(a);
  if (temp &lt;= tempIdeal - tempRange) {
    analogWrite(pinPeltier, levelPeltier);
    analogWrite(pinFan, 0);
    Serial.print("Peltier: on / ");
  } else if (temp &gt;= tempIdeal + tempRange) {
    analogWrite(pinFan, levelFan);
    analogWrite(pinPeltier, 0);
    Serial.print("Fan: on / ");
  } else {
    analogWrite(pinFan, 0);
    analogWrite(pinPeltier, 0);
  }
  Serial.print("Temp: ");
  Serial.print(temp);
  Serial.print(" / Ideal: ");
  Serial.println(tempIdeal);
  delay(1000);
}
</pre>
<video controls="" preload="auto"><source src="medias/output-devices-incubator-incubator-prototype.mp4" type="video/mp4"/></video>
<h3 id="results">Results</h3>
<p>The overall result of this prototype is quite good. The temperature is easily regulated with the Peltier and the fan, and the thermistor obtains precise values.</p>
<figure class="md"><img alt="incubator prototype" loading="lazy" src="medias/output-devices-incubator-incubator-overview.jpg"><figcaption>incubator prototype</figcaption></figure>
<p>When I tried plugging in the devices for the first time, I was running them at 12 V continuously, but the wires and MOSFETS quickly became very hot, which was a concern. There was too much current in the circuit. Fortunately, not using them continuously but at regular intervals has given us much better results: the devices always work as we want when they receive less current, at least for my needs. This brings me to the PWM tip (as mentioned above).</p>
<figure class="md"><img alt="incubator prototype" loading="lazy" src="medias/output-devices-incubator-incubator-close.jpg"><figcaption>incubator prototype</figcaption></figure>
<p>I put the thermistor and the Pelier in a cup, to allow the system to increase its temperature without losing too much heat in the surrounding environment. The fan is positioned in front of them, which gives us the possibility to expel the hot air.</p>
<figure class="md"><img alt="incubator prototype" loading="lazy" src="medias/output-devices-incubator-incubator-power.jpg"><figcaption>incubator prototype</figcaption></figure>
<h1 id="next">Next</h1>
<p>Now that the electronics work as I want, I hand over to my partner. The next step will probably be a real test with a closed space to see how quickly we can lower or increase the temperature inside. We are also thinking of using the fan to distribute the heat evenly. Be sure to read <a class="external" href="https://maudb.gitlab.io/dok/projects/biolab-kitchen/" target="_blank">Maud's documentation</a> to see her progress on the incubator.</p>
<h3 id="references">References</h3>
<ul>
<li><a class="external" href="https://biohackacademy.github.io/bha6/class/3/pdf/3.4%20Incubator%20design.pdf" target="_blank">Biohack Academy: Incubator</a></li>
<li><a class="external" href="https://maudb.gitlab.io/dok/projects/biolab-kitchen/" target="_blank">BioLab Kitchen by Maud Bausier</a></li>
<li><a class="external" href="https://bildr.org/2012/03/rfp30n06le-arduino/" target="_blank">High-Power Control: Arduino + N-Channel MOSFET</a></li>
<li><a class="external" href="https://www.sparkfun.com/news/819" target="_blank">Sparkfun: MOSFETS explained</a></li>
<li><a class="external" href="https://allpinouts.org/pinouts/connectors/motherboards/motherboard-cpu-4-pin-fan/" target="_blank">4 Pin Fan</a></li>
<li><a class="external" href="https://nodemcu.readthedocs.io/en/master/" target="_blank">NodeMCU documentation</a></li>
<li><a class="external" href="https://www.instructables.com/id/NodeMCU-ESP8266-Details-and-Pinout/" target="_blank">NodeMCU details and Pinout</a></li>
<li><a class="external" href="https://docs.platformio.org/en/latest/boards/espressif8266/nodemcuv2.html" target="_blank">PlatformIO NodeMCU 1.0</a></li>
</ul>
</section>
<aside>
<p>✎ <span>Created</span> 16/04/2020</p>
<p>⁂ <span>Updated</span> 16/04/2020</p>
<a class="btn-vscode hidden" href="vscode://file/Users/antoine/repo/websites/personal-website/content/2020-09-01-fabacademy2020/2020-04-15-output-devices/2020-04-16-output-devices-incubator/_index.md">✎ vscode</a>
</aside>
</article>
</article>
<script>
  // show vscode button in local only
  var isLocal = window.location.href.startsWith("file://");
  var btnsCode = document.getElementsByClassName("btn-vscode");
  for (var i = 0; i < btnsCode.length; i++) {
    var btn = btnsCode[i];
    if (isLocal) {
      btn.classList.remove("hidden");
    }
  }
  // shortcut for vscode button
  if (isLocal) {
    var firstBtnCode = btnsCode[0];
    function handleClick() {
      firstBtnCode.click();
    }
    firstBtnCode.addEventListener("click", handleClick);
    function handleKeyboardShortcut(event) {
      if (event.ctrlKey && event.shiftKey && event.key === "D") {
        if (firstBtnCode) {
          firstBtnCode.click();
        }
      }
    }
    document.addEventListener("keydown", handleKeyboardShortcut);
  }
</script>
<!-- /content -->
<footer class="footer">
<p>antoinejaunard.com ☼ 2024 — <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> — <a href="https://antoinejaunard.com/rss.xml">RSS Feed</a></p>
</footer>
</main>
</body>
</html>